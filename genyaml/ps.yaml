obs space:
  name: station surface pressure
  distribution:
    !INC distribution.yaml
  io pool:
    max pool size: 1
  obsdatain:
    engine:
      type: H5File
      obsfile: $(PS_OBSINFILE)
  obsdataout:
    engine:
      type: H5File
      obsfile: $(PS_OBSOUTFILE)
  simulated variables: [stationPressure]
obs operator:
  name: SfcPCorrected
  da_psfc_scheme: GSI
 #geovar_sfc_geomz: surface_geometric_height
  geovar_geomz: geopotential_height
linear obs operator:
  name: Identity
obs pre filters:
# Observation Range Sanity Check
- filter: Bounds Check
  filter variables:
  - name: stationPressure
  minvalue: 37499
  maxvalue: 106999
  action:
    name: reject
# PrepBUFR check to be supplemented later
- filter: RejectList
  where:
  - variable:
      name: stationPressure@PreQC
    is_in: 4-15
# error assignments
- filter: Perform Action
  filter variables:
  - name: stationPressure
  where:
  - variable: stationPressure@ObsType
    is_in: [181]
  action:
    name: assign error
    error function:
      name: ObsErrorModelStepwiseLinear@ObsFunction
      options:
        xvar:
          name: ObsValue/stationPressure
        xvals: [80000, 75000]
        errors: [110, 120]
- filter: Perform Action
  filter variables:
  - name: stationPressure
  where:
  - variable: stationPressure@ObsType
    is_in: [187]
  action:
    name: assign error
    error function:
      name: ObsErrorModelStepwiseLinear@ObsFunction
      options:
        xvar:
          name: ObsValue/stationPressure
        xvals: [85000, 80000]
        errors: [120, 140]
obs prior filters:
# error inflation based on Ps correction
- filter: Perform Action
  filter variables:
  - name: stationPressure
  action:
    name: inflate error
    inflation variable:
      name: ObsErrorFactorSfcPressure@ObsFunction
      options:
        geovar_geomz: geopotential_height
       #geovar_sfc_geomz: surface_geometric_height
obs post filters:
- filter: Background Check
  filter variables:
  - name: stationPressure
  threshold: 5.0
  action:
    name: reject
  where:
  - variable: stationPressure@PreQC
    is_not_in: [3]
- filter: Background Check
  filter variables:
  - name: stationPressure
  threshold: 3.5
  action:
    name: reject
  where:
  - variable: stationPressure@PreQC
    is_in: [3]
obs localizations:
  - localization method: Horizontal Gaspari-Cohn
    lengthscale: 1250e3
    max nobs: 10000
